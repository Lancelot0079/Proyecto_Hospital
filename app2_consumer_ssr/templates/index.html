<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>App2 → Control de Equipos Externos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
  <h3>App2 — Sistema de Control de Equipos Externos</h3>
  <p class="text-muted">Consumiendo datos desde App1 (/api/equipos)</p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="my-2">
        {% for cat,msg in messages %}
          <div class="alert alert-{{cat}} mb-2">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-body">
      <h6 class="card-title">Filtros</h6>
      <form method="get" class="row g-2">
        <div class="col-md-3">
          <select class="form-select" name="tipo">
            <option value="">Todos los tipos</option>
            <option value="tecnologico" {% if request.args.get('tipo') == 'tecnologico' %}selected{% endif %}>Tecnológico</option>
            <option value="biomedico" {% if request.args.get('tipo') == 'biomedico' %}selected{% endif %}>Biomédico</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" name="estado">
            <option value="">Todos los estados</option>
            <option value="ingresado" {% if request.args.get('estado') == 'ingresado' %}selected{% endif %}>Ingresado</option>
            <option value="en_revision" {% if request.args.get('estado') == 'en_revision' %}selected{% endif %}>En revisión</option>
            <option value="autorizado" {% if request.args.get('estado') == 'autorizado' %}selected{% endif %}>Autorizado</option>
            <option value="rechazado" {% if request.args.get('estado') == 'rechazado' %}selected{% endif %}>Rechazado</option>
            <option value="retirado" {% if request.args.get('estado') == 'retirado' %}selected{% endif %}>Retirado</option>
          </select>
        </div>
        <div class="col-md-4">
          <input type="text" class="form-control" name="q" placeholder="Buscar..." value="{{ request.args.get('q', '') }}">
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-outline-primary w-100">Filtrar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Formulario de creación -->
  <div class="card mb-4">
    <div class="card-body">
      <h6 class="card-title">Registrar Nuevo Equipo</h6>
      <form class="row g-2" method="post" action="{{ url_for('crear') }}">
        <div class="col-md-2">
          <select class="form-select" name="tipo" required>
            <option value="">Tipo *</option>
            <option value="tecnologico">Tecnológico</option>
            <option value="biomedico">Biomédico</option>
          </select>
        </div>
        <div class="col-md-2">
          <input class="form-control" name="categoria" placeholder="Categoría *" required>
        </div>
        <div class="col-md-2">
          <input class="form-control" name="marca" placeholder="Marca">
        </div>
        <div class="col-md-2">
          <input class="form-control" name="modelo" placeholder="Modelo">
        </div>
        <div class="col-md-2">
          <input class="form-control" name="serie" placeholder="Serie">
        </div>
        <div class="col-md-2">
          <select class="form-select" name="estado">
            <option value="ingresado">Ingresado</option>
            <option value="en_revision">En revisión</option>
            <option value="autorizado">Autorizado</option>
          </select>
        </div>
        <div class="col-md-2">
          <select class="form-select" name="condicion">
            <option value="operativo">Operativo</option>
            <option value="averiado">Averiado</option>
            <option value="contaminado">Contaminado</option>
            <option value="desconocido">Desconocido</option>
          </select>
        </div>
        <div class="col-md-3">
          <input class="form-control" name="servicio" placeholder="Servicio">
        </div>
        <div class="col-md-3">
          <input class="form-control" name="responsable_externo" placeholder="Responsable Externo">
        </div>
        <div class="col-md-4">
          <input class="form-control" name="observaciones" placeholder="Observaciones">
        </div>
        <div class="col-md-2 d-grid">
          <button class="btn btn-primary">Registrar Equipo</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla de equipos -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Tipo</th>
          <th>Categoría</th>
          <th>Marca/Modelo</th>
          <th>Serie</th>
          <th>Estado</th>
          <th>Condición</th>
          <th>Servicio</th>
          <th>Responsable</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in equipos %}
        <tr>
          <td>{{ e.id }}</td>
          <td>
            {% if e.tipo == "biomedico" %}
              <span class="badge bg-danger">Biomédico</span>
            {% else %}
              <span class="badge bg-primary">Tecnológico</span>
            {% endif %}
          </td>
          <td>{{ e.categoria or "-" }}</td>
          <td>
            <small>
              <strong>{{ e.marca or "-" }}</strong><br>
              {{ e.modelo or "-" }}
            </small>
          </td>
          <td><code>{{ e.serie or "-" }}</code></td>
          <td>
            {% if e.estado == "ingresado" %}
              <span class="badge bg-warning text-dark">Ingresado</span>
            {% elif e.estado == "en_revision" %}
              <span class="badge bg-info text-dark">En revisión</span>
            {% elif e.estado == "autorizado" %}
              <span class="badge bg-success">Autorizado</span>
            {% elif e.estado == "rechazado" %}
              <span class="badge bg-danger">Rechazado</span>
            {% elif e.estado == "retirado" %}
              <span class="badge bg-secondary">Retirado</span>
            {% endif %}
          </td>
          <td>
            {% if e.condicion == "operativo" %}
              <span class="badge bg-success">Operativo</span>
            {% elif e.condicion == "averiado" %}
              <span class="badge bg-danger">Averiado</span>
            {% elif e.condicion == "contaminado" %}
              <span class="badge bg-warning">Contaminado</span>
            {% else %}
              <span class="badge bg-secondary">Desconocido</span>
            {% endif %}
          </td>
          <td>{{ e.servicio or "-" }}</td>
          <td><small>{{ e.responsable_externo or "-" }}</small></td>
          <td class="text-nowrap">
            <form class="d-inline" method="post" action="{{ url_for('eliminar', eid=e.id) }}">
              <button class="btn btn-sm btn-danger" onclick="return confirm('¿Eliminar equipo?')">Eliminar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
        {% if not equipos %}
        <tr><td colspan="10" class="text-center text-muted">No se encontraron equipos</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</body>
</html>